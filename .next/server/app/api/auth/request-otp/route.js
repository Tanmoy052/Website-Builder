"use strict";(()=>{var e={};e.id=730,e.ids=[730],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6113:e=>{e.exports=require("crypto")},897:(e,t,s)=>{s.r(t),s.d(t,{originalPathname:()=>y,patchFetch:()=>g,requestAsyncStorage:()=>l,routeModule:()=>h,serverHooks:()=>f,staticGenerationAsyncStorage:()=>m});var r={};s.r(r),s.d(r,{POST:()=>c});var a=s(9303),i=s(8716),o=s(670),n=s(7070),u=s(889),d=s(2023),p=s.n(d);async function c(e){try{let{email:t}=await e.json();if(!t)return n.NextResponse.json({error:"Email required"},{status:400});let s=await u.db.findUserByEmail(t);s||(s=await u.db.createUser({id:crypto.randomUUID(),email:t,isVerified:!1,createdAt:new Date}));let r=Math.floor(1e5+9e5*Math.random()).toString(),a=await p().hash(r,10);await u.db.saveOTP({userId:s.id,otpHash:a,expiresAt:new Date(Date.now()+3e5),used:!1}),console.log(`[SECURITY] OTP for ${t}: ${r}`);let i=n.NextResponse.json({message:"OTP sent successfully",email:t});return i.headers.set("X-Content-Type-Options","nosniff"),i.headers.set("X-Frame-Options","DENY"),i.headers.set("Strict-Transport-Security","max-age=31536000; includeSubDomains"),i}catch(e){return n.NextResponse.json({error:"Internal Server Error"},{status:500})}}let h=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/auth/request-otp/route",pathname:"/api/auth/request-otp",filename:"route",bundlePath:"app/api/auth/request-otp/route"},resolvedPagePath:"C:\\Users\\tanmo\\Downloads\\website-builder\\app\\api\\auth\\request-otp\\route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:l,staticGenerationAsyncStorage:m,serverHooks:f}=h,y="/api/auth/request-otp/route";function g(){return(0,o.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:m})}},889:(e,t,s)=>{s.d(t,{db:()=>a});class r{async findUserByEmail(e){return this.users.find(t=>t.email===e)}async createUser(e){return this.users.push(e),e}async updateUserVerification(e,t){let s=this.users.find(t=>t.email===e);s&&(s.isVerified=t)}async saveOTP(e){this.otps=this.otps.filter(t=>t.userId!==e.userId),this.otps.push(e)}async getOTP(e){return this.otps.find(t=>t.userId===e)}async markOTPUsed(e){let t=this.otps.find(t=>t.userId===e);t&&(t.used=!0)}async saveChat(e){return this.chats.push(e),e}async saveProject(e){return this.projects.push(e),e}async getUserHistory(e){return{chats:this.chats.filter(t=>t.userId===e).sort((e,t)=>t.createdAt.getTime()-e.createdAt.getTime()),projects:this.projects.filter(t=>t.userId===e).sort((e,t)=>t.createdAt.getTime()-e.createdAt.getTime()),files:this.files.filter(t=>t.userId===e).sort((e,t)=>t.createdAt.getTime()-e.createdAt.getTime())}}constructor(){this.users=[],this.chats=[],this.projects=[],this.files=[],this.otps=[]}}let a=new r}};var t=require("../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[948,972,23],()=>s(897));module.exports=r})();